<h1 mat-dialog-title>Clinical Workflow</h1>
<app-component-spinner [loading]="loading"></app-component-spinner>
<div mat-dialog-content>
  <div class="flex flex-col">
    <div class="text-base">
      Run the clinical workflow for the project
      <b class="text-primary-60">{{ data.projectName }}</b>
    </div>
    <form [formGroup]="jobForm">
      <div class="flex flex-col gap-2">
        <div class="flex flex-row items-center gap-2 mt-2">
          <mat-form-field appearance="outline" class="flex-1">
            <mat-label>Append to job name</mat-label>
            <input matInput formControlName="bulkJobName" autocomplete="off" />
          </mat-form-field>
        </div>
        <div class="flex flex-row flex-wrap items-center gap-2">
          <button
            mat-raised-button
            color="primary"
            (click)="applyJobNameToAll()"
            [disabled]="jobForm.controls['bulkJobName'].invalid"
          >
            Apply
          </button>
          <button mat-raised-button color="primary" (click)="applyIndexToAll()">
            Apply Index
          </button>
          <button
            mat-raised-button
            color="primary"
            (click)="applyFilenameToAll()"
          >
            Apply Filenames
          </button>
          <button mat-raised-button color="warn" (click)="clearAllJobNames()">
            Clear All
          </button>
        </div>
      </div>
      <div class="scrollable-form overflow-y-auto mx-h-80 border rounded p-4">
        <table mat-table [dataSource]="dataSource" matSort class="w-full">
          <ng-container matColumnDef="filename">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Filename</th>
            <td mat-cell *matCellDef="let row">{{ row.filename }}</td>
          </ng-container>
          <ng-container matColumnDef="jobName">
            <th mat-header-cell *matHeaderCellDef>Job Name</th>
            <td mat-cell *matCellDef="let row">
              <mat-form-field appearance="outline" class="w-full no-subscript">
                <input
                  matInput
                  [formControlName]="'job_' + row.jobName"
                  required
                  autocomplete="off"
                />
              </mat-form-field>
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
      </div>
      @if (showMissingToRefOption) {
        <mat-checkbox formControlName="missingToRef">
          Treat missing variants as reference
        </mat-checkbox>
      }
    </form>
  </div>
  <div class="flex flex-row space-x-1 items-center my-2">
    <button mat-raised-button mat-dialog-close color="primary">Close</button>
    <button
      mat-raised-button
      color="primary"
      class="w-[110px]"
      [disabled]="jobForm.invalid"
      (click)="this.submit()"
    >
      Submit
    </button>
  </div>
</div>
