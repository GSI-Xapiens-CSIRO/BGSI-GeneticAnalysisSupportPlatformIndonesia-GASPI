<div class="relative min-w-[300px] md:min-w-[700px] max-w-[800px]">
  <h1 mat-dialog-title class="text-2xl font-semibold text-primary mb-4">
    Your Report is Ready to Generate
  </h1>
  <app-component-spinner [loading]="loading"></app-component-spinner>

  <div mat-dialog-content>

    <form [formGroup]="reportForm">
      <p class="text-gray-600 mb-4">Please fill in the following information first</p>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

        <!-- Left Column - Patient Information (PII) -->
        <div class="flex flex-col gap-4" formGroupName="pii">
          <mat-form-field>
            <mat-label>Patient Name</mat-label>
            <input
              matInput
              type="text"
              placeholder="Enter patient name"
              formControlName="patient_name"
            />
            <mat-error>{{ getErrorMessage('pii.patient_name') }}</mat-error>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Date of Birth</mat-label>
            <input
              matInput
              type="date"
              formControlName="date_of_birth"
            />
            <mat-error>{{ getErrorMessage('pii.date_of_birth') }}</mat-error>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Rekam Medis</mat-label>
            <input
              matInput
              type="text"
              placeholder="Enter medical record number"
              formControlName="rekam_medis"
            />
            <mat-error>{{ getErrorMessage('pii.rekam_medis') }}</mat-error>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Gender</mat-label>
            <mat-select formControlName="gender">
              <mat-option *ngFor="let option of genderOptions" [value]="option.value">
                {{ option.label }}
              </mat-option>
            </mat-select>
            <mat-error>{{ getErrorMessage('pii.gender') }}</mat-error>
          </mat-form-field>
        </div>

        <!-- Right Column - Clinical & Laboratory Information (Non-PII) -->
        <div class="flex flex-col gap-4" formGroupName="nonPii">
          <mat-form-field>
            <mat-label>Referring Clinician</mat-label>
            <input
              matInput
              type="text"
              placeholder="Enter referring clinician name"
              formControlName="referring_clinician"
            />
            <mat-error>{{ getErrorMessage('nonPii.referring_clinician') }}</mat-error>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Sampling Date</mat-label>
            <input
              matInput
              type="date"
              formControlName="sampling_date"
            />
            <mat-error>{{ getErrorMessage('nonPii.sampling_date') }}</mat-error>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Testing Date</mat-label>
            <input
              matInput
              type="date"
              formControlName="testing_date"
            />
            <mat-error>{{ getErrorMessage('nonPii.testing_date') }}</mat-error>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Reporting Date</mat-label>
            <input
              matInput
              type="date"
              formControlName="reporting_date"
            />
            <mat-error>{{ getErrorMessage('nonPii.reporting_date') }}</mat-error>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Referring Institution</mat-label>
            <input
              matInput
              type="text"
              placeholder="Enter referring institution"
              formControlName="reffering_institution"
            />
            <mat-error>{{ getErrorMessage('nonPii.reffering_institution') }}</mat-error>
          </mat-form-field>

          <mat-form-field>
            <mat-label>Testing Laboratory</mat-label>
            <input
              matInput
              type="text"
              placeholder="Enter testing laboratory"
              formControlName="testing_laboratory"
            />
            <mat-error>{{ getErrorMessage('nonPii.testing_laboratory') }}</mat-error>
          </mat-form-field>
        </div>
      </div>
    </form>

    <br />
    <div class="flex justify-end space-x-3">
      <button
        class="min-w-[100px]"
        mat-button
        mat-raised-button
        color="primary"
        (click)="onCancel()"
      >
        Cancel
      </button>
      <button
        class="min-w-[140px]"
        mat-raised-button
        color="primary"
        (click)="onSubmit()"
        [disabled]="reportForm.invalid"
      >
        Generate Report
      </button>
    </div>
  </div>
</div>
<a #downloadLink class="invisible" download="report.pdf"></a>
