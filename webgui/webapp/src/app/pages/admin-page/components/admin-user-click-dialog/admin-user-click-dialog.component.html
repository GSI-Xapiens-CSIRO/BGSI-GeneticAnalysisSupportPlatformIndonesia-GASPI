<div class="relative min-w-[300px] md:min-w-[800px] max-w-[800px]">
  <h1 mat-dialog-title>{{ isCreateMode ? 'Create New User' : 'Update ' + data.name }}</h1>
  <div class="flex flex-col gap-2 p-4 mx-4 mb-4 font-medium text-yellow-800 rounded-lg bg-yellow-100" role="alert">
    <div>Please ensure that the person you are onboarding has the appropriate role and access permissions as required!</div>
  </div>
  <app-component-spinner [loading]="loading"></app-component-spinner>
  <div mat-dialog-content class="px-4">
    <div class="flex gap-6" [formGroup]="form">
      <!-- Left Column: User Info -->
      <div class="flex flex-col gap-4 w-1/2">
        <div class="font-semibold text-lg mb-2">User Info</div>

        <div class="flex flex-col gap-2">
          <mat-form-field>
            <mat-label>First name</mat-label>
            <input
              matInput
              type="text"
              placeholder="John"
              formControlName="firstName"
            />
            <mat-error>Field is required</mat-error>
          </mat-form-field>
          <mat-form-field>
            <mat-label>Last name</mat-label>
            <input
              matInput
              type="text"
              placeholder="Doe"
              formControlName="lastName"
            />
            <mat-error>Field is required</mat-error>
          </mat-form-field>
          <mat-form-field>
            <mat-label>Email address</mat-label>
            <input
              matInput
              type="email"
              placeholder="user@domain.com"
              formControlName="email"
            />
            @if (isCreateMode) {
              <mat-hint>Enter the email address (case insensitive)</mat-hint>
            }
            <mat-error>Valid email is required</mat-error>
          </mat-form-field>
        </div>

        <mat-form-field class="w-full">
          <mat-label>Role</mat-label>
          <mat-select formControlName="roleId">
            @for (role of availableRoles; track role.role_id) {
              <mat-option [value]="role.role_id">{{ role.role_name }}</mat-option>
            }
          </mat-select>
          <mat-error>Role is required</mat-error>
        </mat-form-field>

        <div class="flex flex-col gap-2">
          <label class="font-medium">Institution</label>
          <mat-radio-group
            formControlName="institutionType"
            class="institution-radio-group flex gap-4"
          >
            <mat-radio-button
              [value]="institutionTypeValue.INTERNAL"
              class="institution-radio-option"
            >
              Internal
            </mat-radio-button>
            <mat-radio-button
              [value]="institutionTypeValue.EXTERNAL"
              class="institution-radio-option"
            >
              External
            </mat-radio-button>
          </mat-radio-group>

          <mat-form-field class="w-full mt-2">
            <mat-label>Institution Name</mat-label>
            <input matInput type="text" formControlName="institutionName" />
            <mat-error>Field is required</mat-error>
          </mat-form-field>
        </div>
      </div>

      <!-- Right Column: Quota -->
      <div class="flex flex-col gap-4 w-1/2">
        <div class="font-semibold text-lg mb-2">Quota</div>

        <div class="flex flex-col gap-2">
          <mat-form-field>
            <mat-label>Size of Data</mat-label>
            <input matInput type="number" formControlName="quotaSize" />
            <span matTextSuffix>GB</span>
            <mat-error>
              @if (form.get("quotaSize")?.hasError("required")) {
                Field is required
              }
              @if (form.get("quotaSize")?.hasError("quotaExceeded")) {
                The Size of data must be more than {{ usageSizeText }}.
              }
            </mat-error>
          </mat-form-field>
          <mat-form-field>
            <mat-label>Count of Queries</mat-label>
            <input matInput type="number" formControlName="quotaQueryCount" />
            <span matTextSuffix>Count</span>
            <mat-error>
              @if (form.get("quotaQueryCount")?.hasError("required")) {
                Field is required
              }
              @if (form.get("quotaQueryCount")?.hasError("quotaExceeded")) {
                The query count must be more than {{ usageCount }}.
              }
            </mat-error>
          </mat-form-field>
        </div>

        <div class="flex flex-col gap-1">
          <div class="flex items-center gap-2">
            <span>Estimated Cost* :</span>
            <span class="font-semibold">${{ costEstimation }} / Month</span>
          </div>
          <span class="text-red-500 text-sm">
            *Disclaimer: This above cost is an approximate and rounded off value
          </span>
        </div>

        <div class="flex flex-col gap-2">
          <label class="font-medium">Notebook Options</label>
          <mat-radio-group
            formControlName="notebookRole"
            class="notebook-radio-group flex flex-col gap-2"
          >
            <mat-radio-button
              [value]="noteBookRoleValue.ADVANCED"
              class="notebook-radio-option"
            >
              <div class="label">
                <strong>Advanced</strong>
                <div class="text-primary-60 text-sm">
                  shows all available instance types and volume options during
                  notebook creation.
                </div>
              </div>
            </mat-radio-button>

            <mat-radio-button
              [value]="noteBookRoleValue.BASIC"
              class="notebook-radio-option"
            >
              <div class="label">
                <strong>Basic</strong>
                <div class="text-primary-60 text-sm">
                  shows only the ml.t3.medium instance with a 5 GB volume during
                  notebook creation.
                </div>
              </div>
            </mat-radio-button>
          </mat-radio-group>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="flex flex-col gap-3 mt-6">
      @if (!isCreateMode) {
        <div class="flex gap-3">
          @if (data.mfaActive) {
            <button
              mat-raised-button
              color="warn"
              (click)="disableMFA()"
              [disabled]="disableDelete"
              class="w-[110px]"
            >
              Clear MFA
            </button>
          }
          <button
            mat-raised-button
            color="warn"
            (click)="delete()"
            [disabled]="disableDelete"
            class="w-[110px]"
          >
            Delete
          </button>
        </div>
      }
      <div class="flex gap-3">
        <button
          class="w-[110px]"
          mat-raised-button
          color="primary"
          (click)="cancel()"
        >
          Cancel
        </button>
        <button
          class="w-[120px]"
          mat-raised-button
          color="primary"
          (click)="done()"
          [disabled]="form.invalid || !costEstimation || loadingCostEstimation"
        >
          {{ isCreateMode ? 'Create User' : 'Update' }}
        </button>
      </div>
    </div>
  </div>
</div>
